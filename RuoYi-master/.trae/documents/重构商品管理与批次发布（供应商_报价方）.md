## 关键澄清
- 报价阶段仅需校验“单条报价的数量 ≤ 批次商品发布数量”；不进行库存占用或扣减。
- 只有供货商在运营端将报价设为中标时，才预占库存；同一商品在该批次的所有中标数量之和不得超过发布数量。

## 目标
- 一次发布：创建批次 → 多选商品并填写发布数量 → 一键发布。
- 中标后预占：对中标报价进行库存预占与记录，无超卖。
- 角色隔离与黑名单生效。

## 数据模型调整（最小化）
- `prod_info` 增加：`locked_count`（bigint，默认 0）：中标后预占数量；不在报价阶段变动。
- `prod_quotation_history` 增加：`award_status`（0 待评、1 中标、2 未中标）、`award_time`（datetime）。

## 后端接口
- 批次发布（运营端）：
  - POST `/product/batch/publish`
    - 入参：批次信息 + 商品明细 `[{prodTemplateId, count}]`
    - 行为：创建 `BatchInfo` → 为每个选中商品生成批次内 `ProdInfo`（设置 `batchId/batchNo` 与发布数量）。
  - POST `/product/batch/{batchId}/items`：批次追加商品（同上）。
- 报价（C 端）：
  - POST `/product/quote`
    - 校验：`requestedCount <= prod_info.count`（仅单条校验，不占用库存）。
- 设为中标（运营端）：
  - POST `/product/quote/{id}/award`
    - 读取该商品在批次内的当前 `locked_count` 与本批次所有已中标报价的数量和；校验 `locked_count + 当前中标数量 ≤ prod_info.count`；通过后：
      - 更新 `prod_info.locked_count += 当前中标数量`
      - 更新报价 `award_status=1, award_time=now()`

## 前端改造（运营端）
- 批次发布向导（增强 `product/batch/add.html` 或新增 `publish.html`）：批次表单 + 商品多选表格（支持搜索/分页）+ 行内数量输入；提交到 `/product/batch/publish`。
- 报价列表页面增加“设为中标”操作与当前商品“发布数量/已锁定数量”提示。

## 黑名单与角色
- 黑名单：在“供报价方的批次与商品列表”查询时按 `quotation_black_user` 过滤。
- 角色：沿用运营端（供货商）/C 端（报价方）区分；菜单与权限沿用 `product:*` 前缀。

## 并发与一致性（简化）
- 报价阶段不做库存占用；避免复杂并发控制。
- 中标动作在单次事务内完成校验与 `locked_count` 更新，保证总中标数量不超过发布数量（适度即可）。

## 变更范围（文件参考）
- 控制器：`ruoyi-admin/.../product/BatchInfoController.java`、`ProdQuotationHistoryController.java`
- 领域与服务：`ruoyi-system/.../product/domain/ProdInfo.java`、`ProdQuotationHistory.java`、`IBatchInfoService`、`IProdQuotationHistoryService` 与对应实现；Mapper XML 增量。
- 前端模板：`ruoyi-admin/.../templates/product/batch/*`，必要时扩展 `ry-ui.js` 交互。

## 验收
- 一次性发布批次包含多商品成功；报价单条数量校验生效。
- 中标后库存预占正确，所有中标者的数量之和不超过发布数量。
- 黑名单用户不可见对应供货商的商品/批次。

请确认该简化方案；确认后我将按此实施（后端接口 → 前端页面 → SQL 迁移 → 联调验证）。